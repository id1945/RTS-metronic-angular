<div class="detail">
    <div class="d-flex flex-column-fluid title my-3">
        Thêm mới Chuyến xe đưa đón
    </div>
    <div class="d-flex flex-column-fluid">
        <div #getElementHeight class="col-12 order-1 order-xxl-1 pl-0">
            <div class="box-shadow p-8 radius-10 bg-white">
                <div class="detail_header">
                    <div class="text-left">
                        <div class="company">CÔNG TY CỔ PHẦN LIÊN DOANH Ô TÔ HYUNDAI THÀNH CÔNG VIỆT NAM (HTV)</div>
                    </div>
                    <div class="text-right">
                        <div><img src="assets/media/logos/ycmh_logo_paper.png" alt="logo" height="16" width="240">
                        </div>
                        <div class="today">Hà Nội, Ngày {{today | date: 'dd'}} tháng {{today | date: 'MM'}} năm
                            {{today
                            | date: 'yyyy'}}</div>
                    </div>
                </div>
                <div class="detail_name">
                    <p>THÊM MỚI THÔNG TIN CHUYẾN XE CÔNG TÁC </p>
                </div>
                <!-- Thông tin đăng ký -->
                <div class="mb-5 text-blue-01 font_size_18">
                    Thông tin chi tiết đăng ký
                </div>
                <div>
                    <table class="table table_classic table_40 mt-5">
                        <tr>
                            <td class="pl-3">Người tạo</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.nguoiDatHoTen}}</td>
                            <td>Phòng ban</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.tenPhongBan}}</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 30px;">Thời gian đi</td>
                            <td style="font-weight: bold;">{{ xeDuaDonDetail?.thoiGianDi * 1000 | date: 'dd/MM/yyyy HH:mm'
                                }}</td>
                            <td>Thời gian về</td>
                            <td style="font-weight: bold;">{{ xeDuaDonDetail?.thoiGianVe * 1000 | date: 'dd/MM/yyyy HH:mm'
                                }}</td>
                        </tr>
                        <tr>
                            <td class="pl-3">Tỉnh thành</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.tinhThanhDisplay}}</td>
                            <td>Quận huyện</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.quanHuyenDisplay}}</td>
                        </tr>
                        <tr>
                            <td class="pl-3">Nội dung</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.noiDungCongViec}}</td>
                            <td>Hành trình</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.chiTietHanhTrinh}}</td>
                        </tr>
                        <tr>
                            <td class="pl-3">Phương tiện đề xuất</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.phuongTienDeXuatDisplay}}</td>
                            <td>Hình thức</td>
                            <td class="font-weight-bolder">{{xeDuaDonDetail?.hinhThucLaiXeDisplay}}</td>
                        </tr>
                        <tr>
                            <td class="pl-3">Hình thức công tác</td>
                            <td class="font-weight-bolder" class="font-weight-bolder">{{xeDuaDonDetail?.isTrongKeHoach ? 'Trong kế hoạch' : 'Ngoài kế hoạch'}}</td>
                            <td >Ghi chú</td>
                            <td class="font-weight-bolder" class="font-weight-bolder">{{xeDuaDonDetail?.ghiChu}}</td>
                        </tr>
                    </table>
                </div>

                <div class="mb-5 text-blue-01 font_size_18">Danh sách người đi</div>
                <div class="row">
                    <div class="col-6">
                        <div class="row mb-8">
                            <div class="col-4 ctrl_label">
                                Bộ phận <span class="text-danger">(*)</span>
                            </div>
                            <div class="col-8 select_42">
                                <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Select a person" nzPlaceHolder="-- Lựa chọn --" style="width: 100%;"
                                    [(ngModel)]="nguoiDiSelected.nguoiDiDepartmentKey" (ngModelChange)="onChangeBoPhan($event)">
                                    <ng-container *ngFor="let o of boPhanOptions">
                                        <nz-option [nzValue]="o?.value" [nzLabel]="o?.label"></nz-option>
                                    </ng-container>
                                </nz-select>
                                <div class="text-form text-danger"></div>
                            </div>
                        </div>

                        <div class="row mb-8">
                            <div class="col-4 ctrl_label">
                                Họ tên <span class="text-danger">(*)</span>
                            </div>
                            <div class="col-8 select_42">
                                <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Select a person" nzPlaceHolder="-- Lựa chọn --" style="width: 100%;"
                                    [(ngModel)]="nguoiDiSelected.nguoiDiEmployeeKey" (ngModelChange)="onChangeAddNguoiDi($event)">
                                    <ng-container *ngFor="let o of hoTenOptions">
                                        <nz-option [nzValue]="o?.value" [nzLabel]="o?.label"></nz-option>
                                    </ng-container>
                                </nz-select>
                                <div class="text-form text-danger"></div>
                            </div>
                        </div>

                        <form [formGroup]="formGroup2" (submit)="onAddNguoiDiForm2()">
                            <div class="row mb-8">
                                <div class="col-4 ctrl_label"></div>
                                <div class="col-8 d-flex align-items-center">
                                    <label nz-checkbox formControlName="nguoiDiKhac">Khác</label>
                                </div>
                            </div>

                            <div class="row mb-8" *ngIf="f2?.nguoiDiKhac?.value">
                                <div class="col-4 ctrl_label">
                                    <button type="submit" class="btn btn-outline-primary w-100">Thêm</button>
                                </div>
                                <div class="col-8 row px-0 mx-0">
                                    <div class="col-6">
                                        <input type="text" formControlName="nguoiDiDepartmentKhac"
                                            class="form-control input_42" placeholder="Họ và tên"
                                            [class.is-invalid]="isControlInvalid('nguoiDiDepartmentKhac', 'f2')">
                                    </div>
                                    <div class="col-6">
                                        <input type="text" formControlName="nguoiDiEmployeeKhac"
                                            class="form-control input_42" placeholder="Phòng ban"
                                            [class.is-invalid]="isControlInvalid('nguoiDiEmployeeKhac', 'f2')">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="col-6">
                        <table class="table table_classic table_40 table_no table_blue">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th class="w-50">Phòng ban</th>
                                    <th class="w-50">Họ và tên</th>
                                    <th class="w_50"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of ctNguoiDis?.value; let i = index;">
                                    <td>{{i+1}}</td>
                                    <td>{{item?.nguoiDiDepartmentDisplay || item?.nguoiDiDepartmentKhac}}</td>
                                    <td>{{item?.nguoiDiEmployeeDisplay || item?.nguoiDiEmployeeKhac}}</td>
                                    <td class="w_50 text-center">
                                        <button nz-popconfirm
                                            nzPopconfirmTitle="{{ 'COMMON.btn.are_you_sure' | translate }}"
                                            [nzIcon]="iconTpl" class="btn btn-icon btn-hover font-size-14"
                                            (nzOnConfirm)="removeRow(i)">
                                            <i class="fas fa-trash-alt icon-lg text-danger"></i>
                                        </button>
                                        <ng-template #iconTpl>
                                            <i nz-icon nzType="question-circle-o" style="color: red;"></i>
                                        </ng-template>
                                    </td>
                                </tr>
                                <tr *ngIf="ctNguoiDis?.value?.length == 0">
                                    <td colspan="6" class="text-center text-danger">
                                        <nz-alert
                                            nzType="error"
                                            nzBanner
                                            nzMessage="Vui lòng thêm danh sách người đi!"
                                        ></nz-alert>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <form [formGroup]='formGroup1'>
                    <div class="mb-5 text-blue-01 font_size_18">Phân tài xế và xe cho chuyến đi</div>
                    <div class="row">
                        <!-- col 1 -->
                        <div class="col-6">
                            <div class="row mb-8">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Hình thức dịch vụ <span class="text-danger">(*)</span>
                                </div>
                                <div class="col-7 col-xxl-8 my-3">
                                    <nz-radio-group formControlName="hinhThucDichVu" [ngModel]="'Công ty'" (ngModelChange)="onChangeHinhThucDV($event)">
                                        <label nz-radio nzValue="Công ty">Công ty</label>
                                        <label nz-radio nzValue="Mai Linh">Mai Linh</label>
                                        <label nz-radio nzValue="Grap">Grap</label>
                                    </nz-radio-group>
                                    <div class="text-form text-danger" *ngIf="f1?.hinhThucDichVu?.errors && f1?.hinhThucDichVu?.touched">Hình thức dịch vụ là bắt buộc</div>
                                </div>
                            </div>

                            <div class="row mb-8">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Chọn lái xe <span *ngIf="f1?.hinhThucDichVu?.value == 'Công ty' && f1.isTaiXeKhac.value == false" class="text-danger">(*)</span>
                                </div>
                                <div class="col-5 col-xxl-6 select_42">
                                    <nz-select formControlName="taiXeId" nzShowSearch [nzDisabled]="f1.isTaiXeKhac.value"
                                        nzAllowClear nzPlaceHolder="Chọn lái xe" style="width: 100%;">
                                        <ng-container *ngFor="let o of taiXeOptions">
                                            <nz-option [nzValue]="o?.value" [nzLabel]="o?.label"></nz-option>
                                        </ng-container>
                                    </nz-select>
                                    <div class="text-form text-danger" *ngIf="f1?.taiXeId?.errors && f1?.taiXeId?.touched">Lái xe là bắt buộc</div>
                                </div>
                                <div class="col-2 d-flex align-items-center">
                                    <label nz-checkbox formControlName="isTaiXeKhac">Khác</label>
                                </div>
                            </div>

                            <!-- isTaiXeKhac -->
                            <div class="row mb-8" *ngIf="f1?.isTaiXeKhac?.value">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Nhập họ tên tài xế <span *ngIf="f1?.hinhThucDichVu?.value == 'Công ty' && f1.isTaiXeKhac.value == true" class="text-danger">(*)</span>
                                </div>
                                <div class="col-7 col-xxl-8">
                                    <input type="text" formControlName="taiXeHoTen" class="form-control input_42" placeholder="Nhập họ tên tài xế">
                                    <div class="text-form text-danger" *ngIf="f1?.taiXeHoTen?.errors && f1?.taiXeHoTen?.touched">Họ tên tài xế là bắt buộc</div>
                                </div>
                            </div>

                            <div class="row mb-8">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Chọn xe <span *ngIf="f1?.hinhThucDichVu?.value == 'Công ty' && f1.isXeKhac.value == false" class="text-danger">(*)</span>
                                </div>
                                <div class="col-5 col-xxl-6 select_42">
                                    <nz-select formControlName="xeDonId" nzShowSearch [nzDisabled]="f1.isXeKhac.value"
                                        nzAllowClear nzPlaceHolder="Chọn xe" style="width: 100%;">
                                        <ng-container *ngFor="let o of xeOptions">
                                            <nz-option [nzValue]="o?.value" [nzLabel]="o?.label"></nz-option>
                                        </ng-container>
                                    </nz-select>
                                    <div class="text-form text-danger" *ngIf="f1?.xeDonId?.errors && f1?.xeDonId?.touched">Tên xe là bắt buộc</div>
                                </div>
                                <div class="col-2 d-flex align-items-center">
                                    <label nz-checkbox formControlName="isXeKhac">Khác</label>
                                </div>
                            </div>

                            <!-- isXeKhac -->
                            <div class="row mb-8" *ngIf="f1?.isXeKhac?.value">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Nhập biển số xe <span *ngIf="f1?.hinhThucDichVu?.value == 'Công ty' && f1.isXeKhac.value == true" class="text-danger">(*)</span>
                                </div>
                                <div class="col-7 col-xxl-8">
                                    <input type="text" formControlName="xeDonBienSo" class="form-control input_42" placeholder="Nhập biển số xe">
                                    <div class="text-form text-danger" *ngIf="f1?.xeDonId?.errors && f1?.xeDonId?.touched">Biển số xe là bắt buộc</div>
                                </div>
                            </div>

                            <div class="row mb-8">
                                <div class="col-5 col-xxl-4 ctrl_label">
                                    Cập nhật thời gian đón <span class="text-danger">(*)</span>
                                </div>
                                <div class="col-7 col-xxl-8">
                                    <nz-date-picker nzShowTime formControlName="thoiGianDon" nzPlaceHolder="Chọn thời gian đón"
                                        [nzFormat]="'dd/MM/yyyy HH:mm'" [nzShowTime]="{ nzFormat: 'HH:mm' }" class="form-control input_42">
                                    </nz-date-picker>
                                    <div class="text-form text-danger" *ngIf="f1?.thoiGianDon?.errors && f1?.thoiGianDon?.touched">Thời gian đón là bắt buộc</div>
                                </div>
                            </div>
                        </div>

                        <!-- col 2 -->
                        <div class="col-6">
                            <div class="row mb-8">
                                <ng-container [ngSwitch]="f1?.hinhThucDichVu?.value">
                                    <ng-container *ngSwitchCase="'Mai Linh'">
                                        <div class="col-6 col-xxl-4 ctrl_label">
                                            Mật khẩu thanh toán
                                        </div>
                                        <div class="col-6 col-xxl-8">
                                            <input type="text" formControlName="matKhauThanhToan" class="form-control input_42"
                                            placeholder="Mật khẩu thanh toán">
                                        </div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'Grap'">
                                        <div class="col-6 col-xxl-4 ctrl_label">
                                            Tài khoản thanh toán
                                        </div>
                                        <div class="col-6 col-xxl-8">
                                            <input type="text" formControlName="taiKhoanThanhToan" class="form-control input_42" placeholder="Tài khoản thanh toán">
                                        </div>
                                    </ng-container>
                                    <ng-container *ngSwitchDefault><div class="mb-13"></div></ng-container>
                                </ng-container>
                            </div>

                            <div class="row mb-8">
                                <div class="col-6 col-xxl-4 ctrl_label">
                                    Số điện thoại lái xe
                                </div>
                                <div class="col-6 col-xxl-8">
                                    <input type="text" formControlName="taiXeSoDT" class="form-control input_42" [attr.disabled]="f1?.isTaiXeKhac?.value ? '' : null" placeholder="Số điện thoại lái xe">
                                </div>
                            </div>

                            <!-- isTaiXeKhac -->
                            <div class="row mb-8" *ngIf="f1?.isTaiXeKhac?.value">
                                <div class="col-6 col-xxl-4 ctrl_label">
                                    Nhập số điện thoại tài xế
                                </div>
                                <div class="col-6 col-xxl-8">
                                    <input type="text" formControlName="taiXeSoDT" class="form-control input_42"
                                        placeholder="Nhập số điện thoại tài xế">
                                </div>
                            </div>

                            <div class="row mb-8">
                                <div class="col-6 col-xxl-4 ctrl_label">
                                    Tên xe
                                </div>
                                <div class="col-6 col-xxl-8">
                                    <input type="text" formControlName="xeDonTenXe" class="form-control input_42" [attr.disabled]="f1?.isXeKhac?.value ? '' : null" placeholder="Tên xe">
                                </div>
                            </div>

                            <!-- isXeKhac -->
                            <div class="row mb-8" *ngIf="f1?.isXeKhac?.value">
                                <div class="col-6 col-xxl-4 ctrl_label">
                                    Nhập tên xe
                                </div>
                                <div class="col-6 col-xxl-8">
                                    <input type="text" formControlName="xeDonTenXe" class="form-control input_42"
                                        placeholder="Nhập tên xe">
                                </div>
                            </div>

                            <div class="row mb-8">
                                <div class="col-6 col-xxl-4 ctrl_label">
                                    Cập nhật địa điểm đón <span class="text-danger">(*)</span>
                                </div>
                                <div class="col-6 col-xxl-8">
                                    <input type="text" formControlName="diaChiDon" class="form-control input_42"
                                        placeholder="Cập nhật địa điểm đón">
                                    <div class="text-form text-danger" *ngIf="f1?.diaChiDon?.errors && f1?.diaChiDon?.touched">Địa điểm đón là bắt buộc</div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- ghi chú -->
                    <div class="row mb-8">
                        <div class="col-12 mb-3">
                            Ghi chú
                        </div>
                        <div class="col-12">
                            <textarea rows="4" cols="30" formControlName="ghiChu" class="w-100 form-control" placeholder="Ghi chú"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <!-- footer  -->
            <div class="footer mt-5">
                <div class="d-flex justify-content-end">
                    <div>
                        <button class="btn btn-light btn-14 py-3 mr-2" style="width: 150px"
                            [translate]="'COMMON.btn.cancel'"></button>
                    </div>
                    <div>
                        <button class="btn btn-primary btn-14 py-3 w_130" (click)="onSubmit()"
                            [translate]="'COMMON.btn.record'"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>