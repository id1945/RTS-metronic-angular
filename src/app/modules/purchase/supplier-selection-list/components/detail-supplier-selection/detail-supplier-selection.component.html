<div class="detail">
    <div class="d-flex flex-column-fluid title my-3">
        {{'SUPPLIER.CREATE.step_4.titlePurchaseDetail' | translate}}
    </div>
    <div class="d-flex flex-column-fluid">
        <div #getElementHeight class="col-10 col-lg-9 col-xxl-10 order-1 order-xxl-1 pl-0">
            <div class="box-shadow p-8 radius-10 bg-white">
                <div class="detail_header">
                    <div class="text-left">
                        <div class="company">{{'SUPPLIER.CREATE.step_4.companyName' | translate}}</div>
                    </div>
                    <div class="text-right">
                        <div><img src="assets/media/logos/ycmh_logo_paper.png" alt="logo" height="16" width="240">
                        </div>
                        <div class="today">Hà Nội, Ngày {{dataDetail?.ngayTao* 1000 | date: 'dd'}} tháng {{dataDetail?.ngayTao* 1000 | date: 'MM'}} năm {{dataDetail?.ngayTao* 1000 | date: 'yyyy'}}</div>
                    </div>
                </div>
                <div class="detail_name">
                    <p>  {{'SUPPLIER.CREATE.step_4.titlePurchaseDetail' | translate}}</p> 
                    <p class="i"> V/v : {{dataDetail?.noiDung}} </p>
                </div>
                <div *ngIf="dataDetail?.isAllowPheDuyet || dataDetail?.isAllowThamVan">Kính gửi : Ông/bà : <b>{{tenNguoiPheDuyet}}</b></div>
                <!-- <div class="content_text">
                    Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. 
                </div> -->
                <div>
                    <table class="table table_classic table_40 mt-5">
                        <tr>
                            <td class="pl-5">{{'SUPPLIER.CREATE.step_4.referenceCodeLabel' | translate}}</td>
                            <td class="font-weight-bolder">{{dataDetail?.soDeXuat}}</td>
                            <td>{{'SUPPLIER.CREATE.step_4.formalityLabel' | translate}}</td>
                            <td class="font-weight-bolder">{{dataDetail?.tenHinhThuc}}</td>
                        </tr>
                        <tr>
                            <td class="pl-5">{{'SUPPLIER.CREATE.step_4.departmentLabel' | translate}}</td>
                            <td class="font-weight-bolder">{{dataDetail?.tenBoPhanYCMH}}</td>
                            <td>{{'SUPPLIER.CREATE.step_4.createDateLabel' | translate}}</td>
                            <td class="font-weight-bolder">{{(dataDetail?.ngayTao * 1000 | date: 'dd/MM/yyyy HH:mm') || '-'}}</td>
                        </tr>
                        <tr>
                            <td class="pl-5" >{{'SUPPLIER.CREATE.step_4.purchaseNumberLabel' | translate}}</td>
                            <td colspan="3">
                                <div *ngFor="let item of dataDetail?.ycmh?.items">
                                    <a target="_blank" [routerLink]="['/purchase','detail',item?.idYCMH,item?.maYCMH]">{{item?.maYCMH || '-'}}</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-5">{{'SUPPLIER.CREATE.step_4.proposeNumberLabel' | translate}}</td>
                            
                            <td colspan="3" class="font-weight-bolder">
                                <a target="_blank" [routerLink]="['/submissions','detail',dataDetail?.idToTrinh]">{{dataDetail?.soToTrinhThamChieu || '-'}}</a> 
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-5">{{'SUPPLIER.CREATE.step_4.contentLabel' | translate}}</td>
                            <td colspan="3" class="font-weight-bolder">{{dataDetail?.noiDung}}</td>
                        </tr>
                    </table>
                </div>
                <div *ngIf="dataDetail?.nhaCungCap?.items?.length > 0" >
                    <div class="my-2 title_top" [translate]="'SUPPLIER.CREATE.step_4.table.contract.title'"></div>
                    <table class="table table_classic table_40 table_no">
                        <tr>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.contract.no'"></th>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.contract.supplier'"></th>
                        </tr>
                        <ng-container *ngFor="let item of dataDetail?.nhaCungCap?.items; let i = index">
                            <tr>
                                <td>{{i + 1}}</td>
                                <td>{{item?.tenNhaCungCap || '-'}}</td>
                            </tr>
                        </ng-container>
                    </table>
                </div>
                <div *ngIf="dataDetail?.thongTinHangHoaDichVu?.items?.length > 0">
                    <div class="my-2 title_top" [translate]="'SUPPLIER.CREATE.step_4.table.cphh.title'"></div>
                    <table class="table table_classic table_40 table_no table_blue">
                        <tr>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.cphh.no'"></th>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.cphh.goods_services'"></th>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.cphh.specification'"></th>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.cphh.unit'"></th>
                            <th class="text-right" [translate]="'SUPPLIER.CREATE.step_4.table.cphh.amount'"></th>
                            <th class="text-right" [translate]="'SUPPLIER.CREATE.step_4.table.cphh.unit_price'"></th>
                            <th class="text-right" [translate]="'SUPPLIER.CREATE.step_4.table.cphh.into_money'"></th>
                            <th [translate]="'SUPPLIER.CREATE.step_4.table.cphh.note'">Ghi chú</th>
                        </tr>
                        <ng-container *ngFor="let item of dataDetail?.thongTinHangHoaDichVu?.items; let i = index">
                            <tr>
                                <td>{{i + 1}}</td>
                                <td>{{item?.tenHangHoaDichVu || '-'}}</td>
                                <td>{{item?.quyCach || '-'}}</td>
                                <td>{{item?.tenDVT || '-'}}</td>
                                <td class="text-right">{{item?.soLuong || '-'}}</td>
                                <td class="text-right">{{item?.donGiaChuaVAT | number: '1.0'}}</td>
                                <td class="text-right">{{item?.donGiaChuaVAT*item?.soLuong | number: '1.0'}}</td>
                                <td>{{item?.ghiChu || '-'}}</td>
                            </tr>
                        </ng-container>
                        <tr>
                            <td colspan="5" class="border-top border-right">
                                <div class="text-blue-01 d-flex justify-content-start">
                                    <div class="min_w_80">{{'SUPPLIER.CREATE.step_4.table.cphh.note'| translate}}: </div>
                                    <div class="text-left pr-2">{{dataDetail?.ghiChu}}</div>
                                </div>
                            </td>
                            <td colspan="3" class="border-top">
                                <table class="w-100">
                                    <tr>
                                        <td class="text-right border-left-0 w-50">
                                            <b>{{'SUPPLIER.CREATE.step_4.table.cphh.into_money'| translate}}:</b>
                                        </td>
                                        <td class="border-left-0">
                                            <span class="text-blue-01"><b>{{dataDetail?.thongTinHangHoaDichVu?.tongTienChuaVAT | number: '1.0'}}</b></span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right border-left-0 w-50">
                                            <b>{{'SUPPLIER.CREATE.step_4.table.cphh.discount'| translate}}:</b>
                                        </td>
                                        <td class="border-left-0">
                                            <span class="text-blue-01"><b>{{dataDetail?.thongTinHangHoaDichVu?.tongTienGiamGia || 0 | number: '1.0'}}</b></span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right border-left-0 w-50">
                                            <b>VAT:</b>
                                        </td>
                                        <td class="border-left-0">
                                            <span class="text-blue-01"><b>{{dataDetail?.thongTinHangHoaDichVu?.vat | number: '1.0'}}</b></span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right border-left-0 w-50">
                                            <span class="text-blue-01"><b>{{'SUPPLIER.CREATE.step_4.table.cphh.total'| translate}}:</b></span>
                                        </td>
                                        <td class="border-left-0">
                                            <span class="text-blue-01"><b>{{dataDetail?.thongTinHangHoaDichVu?.tongTienCoVAT | number: '1.0'}}</b></span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
                <div *ngIf="dataDetail?.taiLieuDinhKem?.items?.length > 0">
                    <div class="my-2 title_top">Tài liệu đính kèm</div>
                    <table class="table table_classic table_40 table_no">
                        <tr>
                            <th>STT</th>
                            <th>Tên</th>
                            <th>Ghi chú</th>
                        </tr>
                        <ng-container *ngFor="let item of dataDetail?.taiLieuDinhKem?.items; let i = index">
                            <tr>
                                <td>{{i + 1}}</td>
                                <td class="min_w_500">
                                    <span *ngFor="let iFile of item?.fileDinhKems">
                                        <app-link-file [href]="iFile?.url" [name]="iFile.tenFile"></app-link-file>
                                    </span>
                                </td>
                                <td>{{item.ghiChu}}</td>
                            </tr>
                        </ng-container>
                    </table>
                </div>
            </div>

            <!-- Phản hồi tham vấn -->
            <ng-container *ngIf="dataDetail?.thamVan?.noiDungThuKiThamVans?.length">
                <div class="d-flex flex-column-fluid title my-3">Tham vấn</div>
                <div class="d-flex flex-column-fluid tham_van">
                    <div class="card card-custom w-100 box-shadow detail_ycmh_content">
                        <div class="card-body">
                            <div class="mb-5">
                                <p class="tham_van_title">Nội dung văn bản trình kí</p>
                                <div class="tham_van_content" [innerHTML]="dataDetail?.thamVan?.noiDungTrinhKi | safe: 'html'"></div>
                            </div>
    
                            <div class="mb-5">
                                <p class="tham_van_title">Kiểm tra rà soát nội dung</p>
                                <div class="tham_van_content" [innerHTML]="dataDetail?.thamVan?.noiDungKiemTra | safe: 'html'"></div>
                            </div>
    
                            <div class="mb-5 tham_van_thu_ky">
                                <p class="tham_van_title">Tham vấn của thư ký TGĐ</p>
                                <ng-container *ngFor="let item of dataDetail?.thamVan?.noiDungThuKiThamVans; let i = index">
                                    <div class="d-flex justify-content-between">
                                        <div class="tham_van_content">
                                            <b class="mr-2">{{i + 1}}. Tham vấn {{i+1}}:</b>{{item?.noiDungThamVan}}
                                        </div>
                                        <div >
                                            <label nz-checkbox [(ngModel)]="item.isDaPheDuyet" [nzDisabled]="dataDetail?.isAllowResponseThamVan == false">BLĐ chấp thuận</label>
                                        </div>
                                    </div>
                                    <div class="tham_van_phan_hoi_box">
                                        <div class="tham_van_phan_hoi">Phản hồi tham vấn</div>
                                        <textarea *ngIf="dataDetail?.isAllowResponseThamVan; else showText" [(ngModel)]="item.noiDungPhanHoi" class="tham_van_content tham_van_border form-control" rows="2"></textarea>
                                        <ng-template #showText>
                                            <p>{{item?.noiDungPhanHoi}}</p>
                                        </ng-template>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- footer  -->
            <div class="footer mt-5">
                <div class="d-flex justify-content-end">
                    <div *ngIf="dataDetail?.isAllowTuChoi==true">
                        <button class="btn btn-danger btn-14 py-3 w_130 mr-2" (click)="appApproveModal?.showModal(dataDetail, false)" [translate]="'COMMON.btn.reject'"></button>
                    </div>
                    <div *ngIf="dataDetail?.isAllowThamVan==true">
                        <button class="btn btn-primary btn-14 py-3 w_130 mr-2" (click)="appConsultationModal?.showModal(dataDetail)" [translate]="'COMMON.btn.consultation'"></button>
                    </div>
                    <div *ngIf="dataDetail?.isAllowPheDuyet==true && dataDetail?.isAllowTuChoi==false">
                        <button class="btn btn-primary btn-14 py-3 w_130" (click)="appApproveModal?.showModal(dataDetail, true)" [translate]="'COMMON.btn.consultation'"></button>
                    </div>
                    <div *ngIf="dataDetail?.isAllowPheDuyet==true && dataDetail?.isAllowTuChoi==true">
                        <button class="btn btn-primary btn-14 py-3 w_130" (click)="appApproveModal?.showModal(dataDetail, true)" [translate]="'COMMON.btn.approve'"></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-2 col-lg-3 col-xxl-2 order-2 order-xxl-1 box-shadow radius-10 scroll-gray bg-white" [style.height.px]="getElementHeight?.offsetHeight - 19">
            <app-time-line-approve [data]="timeLine"></app-time-line-approve>
        </div>
    </div>
</div>

<app-approve-supplier-modal #appApproveModal (loadTimeLine)="getDetail()"></app-approve-supplier-modal>
<app-consultation-supplier-modal #appConsultationModal (loadTimeLine)="getDetail()"></app-consultation-supplier-modal>